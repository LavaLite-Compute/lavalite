# LavaLite Job File Format

## Overview

A LavaLite *job file* is a shell script generated by the scheduler and
executed by the execution daemon to start a batch job.

The job file is a **transport wrapper**, not an interactive shell
environment and not a login session replica.

Its primary goals are:

- correctness
- predictability
- POSIX portability
- reproducibility

Convenience features of interactive shells are explicitly out of scope.

---

## Interpreter Contract

- The default interpreter is **`/bin/sh`**
- The job file **must be valid POSIX sh**
- No assumptions are made about:
  - bash extensions
  - user dotfiles
  - interactive shell initialization

Use of `/bin/bash` is **opt-in** and does not relax any environment
serialization rules defined below.

---

## Environment Serialization Contract

The job file may contain environment variable definitions emitted by
LavaLite. These definitions follow strict rules.

### Variable Name (KEY)

A variable name **must** match the POSIX shell identifier grammar:

**[A-Za-z_][A-Za-z0-9_]***


Examples:

| Name                | Valid |
|---------------------|-------|
| PATH                | yes   |
| _FOO                | yes   |
| VAR123              | yes   |
| 1VAR                | no    |
| LD_LIBRARY-PATH     | no    |
| BASH_FUNC_ml%%      | no    |

Entries with invalid names are **not emitted**.

---

### Variable Value (VALUE)

A variable value is treated as **data**, not behavior.

Rules:

- VALUE may contain arbitrary characters
- VALUE **must not contain literal newline characters**
- VALUE is always emitted as a single quoted shell word

Example emission:

```sh
VAR='some value with spaces and symbols'; export VAR

## Example Job File

```sh
#! /bin/sh

# LSBATCH: Environments
PATH='/usr/local/bin:/usr/bin:/bin'; export PATH
OMP_NUM_THREADS='8'; export OMP_NUM_THREADS
MY_FLAG='value with spaces and symbols like ; $ ( )'; export MY_FLAG

$LSB_TRAPSIGS
$LSB_RCP1
$LSB_RCP2
$LSB_RCP3

# LSBATCH: User input
/usr/bin/my_program --input file.dat

ExitStat=$?
wait
# LSBATCH: End user input
true
exit `expr $? "|" $ExitStat`
